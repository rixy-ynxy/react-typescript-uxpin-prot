"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.experimentationRunNgrok = void 0;
const tslib_1 = require("tslib");
const isTestEnv_1 = require("../../../../program/env/isTestEnv");
function experimentationRunNgrok(args, store) {
    return { exec: startNgrok(args, store), shouldRun: !args.disableTunneling };
}
exports.experimentationRunNgrok = experimentationRunNgrok;
const TEST_SESSION_ID = 'https://sessionId.ngrok.io';
function startNgrok(args, store) {
    return (ds) => tslib_1.__awaiter(this, void 0, void 0, function* () {
        let url;
        // Import ngrok only in production environment because of request-promise, ngrok and jest clash
        // https://github.com/request/request-promise/issues/247
        if (isTestEnv_1.isTestEnv()) {
            url = TEST_SESSION_ID;
        }
        else {
            // tslint:disable-next-line:typedef
            const ngrok = require('ngrok');
            url = yield ngrok.connect(args.port);
        }
        store.setState({
            ngrokUrl: url,
        });
        return ds;
    });
}
//# sourceMappingURL=experimentationRunNgrok.js.map